"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};void function(e){function t(t){e.ajax({type:"GET",url:"/getRootDirectory",success:function(e){t.prop("rootDirectory",e),t.trigger("s3Initialized")}})}function a(t,a){var i=t.data.wrapper;return i.trigger("gettingFiles"),a&&a.files?void i.trigger("gotFiles",[null,a]):void e.ajax({type:"GET",url:"/getFiles",dataType:"json",contentType:"application/json",data:a||{},success:function(e){i.trigger("gotFiles",[null,e])},error:function(e){i.trigger("gotFiles",[e])}})}function i(t,a){var i=t.data.wrapper,n=a;if(n.length>0){i.trigger("fileUploading");for(var r=new FormData,o=0;o<n.length;o++){var l=n[o];r.append("files",l,l.name)}r.append("filePath",i.prop("uploadFilePath")),e.ajax({url:"/upload",type:"POST",data:r,processData:!1,contentType:!1,success:function(){i.trigger("filesUploaded")},error:function(e){i.trigger("filesUploaded",[e])}})}else i.trigger("fileUploading",[!0])}function n(t,a){var i=t.data.wrapper;i.trigger("deletingFiles"),e.ajax({type:"POST",url:"/deleteFiles",contentType:"application/json",data:JSON.stringify({files:a}),success:function(){i.trigger("filesDeleted")},error:function(e){i.trigger("filesDeleted",[e])}})}function r(r){var o=e(r);o.off("uploadFiles").on("uploadFiles",{wrapper:o},i),o.off("getFiles").on("getFiles",{wrapper:o},a),o.off("deleteFiles").on("deleteFiles",{wrapper:o},n),t(o)}e.fn.s3=function(){return this.each(function(e,t){r(t)})}}(jQuery.noConflict()),void function(e){function t(e){return e>1073741824?Math.ceil(e/1024/1024/1024)+"gb":e>1048576?Math.ceil(e/1024/1024)+"mb":e>1024?Math.ceil(e/1024)+"kb":e+"b"}function a(e,a){var i=t(e.Size),n=e.Key,r=e.LastModified,o="\n\t\t\t<div class='file-manager--file' title=\""+n+'" data-file-date="'+r+'">\n\t\t\t\t<div class="row">\n\t\t\t\t\t<div class="col-xs-4 file--content">\n\t\t\t\t\t\t'+(a?'<img src="file?file='+n+'&size=128x128" />':'<i class="fa fa-file" aria-hidden="true"></i>')+'\n\t\t\t\t\t\t\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="col-xs-8">\n\t\t\t\t\t\t<h3 class="file--name">'+n.split("/")[n.split("/").length-1]+'</h3>\n\t\t\t\t\t\t<h4 class="file--size">'+(i||"unknown")+"</h4>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t";return o}function i(e){return function(t){t.stopPropagation(),e.attr("disabled",!0).html('<i class="fa fa-spinner fa-spin"></i> Uploading...')}}function n(e,t,a){return function(i,n){return i.stopPropagation(),a.toggleClass("hidden"),n?void e.text("Sorry, something went wrong uploading your file."):void t.trigger("getFiles",[{folder:t.prop("currentDirectory")}])}}function r(e){e.stopPropagation();var t=e.data.content,a=e.data.deleteStartButton;t.html('<div class="p-Xl ta-C js-waiting"><i class="fa fa-spinner fa-spin"></div>'),a.prop("disabled",!0)}function o(t,i,n,r){var o=e('[data-file-manager="current-directory"]');return function(e,t,l){if(t)return void i.text("Sorry, something went wrong getting the files.");var d=l.files||[],p=l.folder;if(n.prop("uploadFilePath",p||""),p){var f=p.split("/");f[0]="My Files",o.text(f.join("/"))}else o.text("Root");i.html("");var s=d.sort(function(e,t){return e.LastModified>t.LastModified?-1:e.LastModified<t.LastModified?1:0});s.length?(r.removeClass("hidden").find(".active").removeClass("active"),r.find('[data-sort="date"]').addClass("active"),s.forEach(function(e){var t=["jpg","svg","png"],n=e.Key.split(".").pop(),r=t.indexOf(n)>-1;i.append(a(e,r))})):(r.addClass("hidden"),i.text("There are no files in this folder, you can upload some or check one of it's sub-folders.")),i.closest('[data-function*="scroll"]').trigger("initScroll")}}function l(t){t.stopPropagation(),t.preventDefault();var a=t.data.search,i=t.data.content,n=i.find(".file-manager--file"),r=a.val().toLowerCase();n.each(function(t,a){var i=e(a),n=i.attr("title").toLowerCase();n.indexOf(r)===-1?i.addClass("hidden"):i.removeClass("hidden")})}function d(t,a,i,n){t.empty(),a.sort(function(t,a){var r=e(t),o=e(a);if("date"===i){var l=new Date(r.attr("data-file-date")),d=new Date(o.attr("data-file-date"));return l>d?"asc"===n?1:-1:l<d?"asc"===n?-1:1:0}var p=r.attr("title").toLowerCase(),f=o.attr("title").toLowerCase();return p>f?"asc"===n?1:-1:p<f?"asc"===n?-1:1:0}),t.append(a)}function p(e,t){e.stopPropagation();var a=e.data.content,i=e.data.deleteStartButton;t.addClass("file-manager--file__active"),a.find(".file-manager--file__active").length?i.prop("disabled",!1):i.prop("disabled",!0)}function f(t){var a=e(t);if(!a.prop("fileManagerInitialized")){var f=a.find('[data-file-manager="content"]'),s=a.find('[data-file-manager="search"]'),c=a.find('[data-file-manager="sort"]'),u=c.find("[data-sort-direction]"),g=a.find('[data-file-manager="delete-start"]'),v=a.find('[data-file-manager="delete-prompt"]'),m=a.find('[data-file-manager="delete"]'),h=a.find('[data-file-manager="delete-cancel"]'),y=v.find(".js-grammar"),w=a.find('[data-file-manager="uploader"]'),D=a.find('[data-file-manager="upload"]'),F=a.find('[data-uploader="upload"]'),C=a.find('[data-file-manager="directory"]');f.on("dragenter",function(e){e.stopPropagation(),e.preventDefault(),f.addClass("file-manager--content__active")}),f.on("dragleave",function(e){e.stopPropagation(),e.preventDefault(),f.removeClass("file-manager--content__active")}),f.on("dragover",function(e){e.stopPropagation(),e.preventDefault();var t=void 0;try{t=e.originalEvent.dataTransfer.effectAllowed}catch(e){t=null}e.originalEvent.dataTransfer.dropEffect="move"===t||"linkMove"===t?"move":"copy"}),f.on("drop",function(e){e.stopPropagation(),e.preventDefault(),w.toggleClass("hidden"),w.trigger("filesAdded",[e.originalEvent.dataTransfer.files]),f.removeClass("file-manager--content__active")}),s.on("input",{content:f,search:s},l),c.on("click","button",function(t){t.stopPropagation(),t.preventDefault();var a=e(t.target),i=a.attr("data-sort"),n=u.attr("data-sort-direction"),r=c.find(".active"),o="asc"===n?"desc":"asc",l=f.find(".file-manager--file");i?a.hasClass("active")?(u.attr("data-sort-direction",o),d(f,l,i,o)):(r.removeClass("active"),a.addClass("active"),d(f,l,i,n)):(u.attr("data-sort-direction",o),d(f,l,r.attr("data-sort"),o))}),C.on("gettingFiles",{content:f,deleteStartButton:g},r),C.on("deletingFiles",{content:f,deleteStartButton:g},r),C.on("gotFiles",o(a,f,w,c)),C.directory(),w.on("fileUploading",i(F)),w.on("filesUploaded",n(f,C,w)),D.on("click",function(e){e.stopPropagation(),e.preventDefault(),w.toggleClass("hidden")}),w.uploader(),a.on("selectFile",{content:f,deleteStartButton:g},p),f.on("click",".file-manager--file",function(t){t.stopPropagation(),t.preventDefault(),a.trigger("selectFile",[e(t.currentTarget),f.find(".file-manager--file__active")])}),g.add(h).on("click",function(e){e.stopPropagation(),e.preventDefault(),f.find(".file-manager--file__active").length>1?y.text("these"):y.text("this"),v.toggleClass("hidden")}),m.on("click",function(t){t.stopPropagation(),t.preventDefault();var a=[];f.find(".file-manager--file__active").each(function(t,i){var n=e(i).attr("title");a.push({Key:n})}),m.prop("disabled",!0).text("Deleting").prepend('<i class="fa fa-spin fa-spinner" aria-hidden="true"></i> '),C.trigger("deleteFiles",[a])}),C.on("filesDeleted",function(e){e.stopPropagation(),v.addClass("hidden"),m.prop("disabled",!1).text("Delete")}),a.prop("fileManagerInitialized",!0)}}e.fn.fileManager=function(){return this.each(function(e,t){f(t)})},e(function(){var t=e('[data-function*="file-manager"');t.length&&t.fileManager()})}(jQuery.noConflict()),void function(e){function t(t,a){t.stopPropagation(),t.preventDefault(),e(t.data.wrapper).trigger("filesAdded",[a])}function a(t,a){return function(i){i.stopPropagation(),i.preventDefault();var n=e(i.target).closest("li"),r=n.attr("data-file-name"),o=t.prop("filesToUpload")||[];o.forEach(function(e,t){if(e.name===r)return void o.splice(t,1)}),n.detach(),0===o.length&&a.prop("disabled",!0),t.prop("filesToUpload",o)}}function i(t,a){t.stopPropagation(),t.preventDefault();for(var i=t.data.wrapper,n=t.data.filesList,r=t.data.uploadButton,o=i.prop("filesToUpload")||[],l=function(t,i){var l=a[t],d=n.find("li").filter(function(t,a){return e(a).attr("data-file-name")===l.name}).length>0;return d?{v:void 0}:(o.push(l),n.append("<li data-file-name='"+l.name+"'><button class='uploader--delete' data-uploader='delete'><i class='fa fa-times' aria-hidden='true'></i><span class='sr-only'>Remove File From Upload List</i></button>"+l.name+"</li>"),void r.prop("disabled",!1))},d=0,p=a.length;d<p;d++){var f=l(d,p);if("object"===("undefined"==typeof f?"undefined":_typeof(f)))return f.v}i.prop("filesToUpload",o)}function n(e){var t=e.data.wrapper,a=e.data.filesList,i=e.data.uploadButton;t.prop("filesToUpload",[]),a.empty(),i.text("Upload").prop("disabled",!1)}function r(r){var o=e(r);if(!o.prop("uploaderInitialized")){var l=o.find('[data-uploader="file-drop"]'),d=o.find('[data-uploader="files"]'),p=o.find('[data-uploader="upload"]'),f=o.find('[data-uploader="cancel"]'),s=e('<input type="file" multiple="true">');o.on("filesAdded",{wrapper:o,filesList:d,uploadButton:p},i),f.on("click",function(e){e.stopPropagation(),e.preventDefault(),d.empty(),o.prop("filesToUpload",[]),p.prop("disabled",!0),o.toggleClass("hidden")}),d.on("click",'[data-uploader="delete"]',a(o,p)),l.on("dragenter",function(e){e.stopPropagation(),e.preventDefault(),l.addClass("uploader--file-drop__active")}),l.on("dragleave",function(e){e.stopPropagation(),e.preventDefault(),l.removeClass("uploader--file-drop__active")}),l.on("dragover",function(e){e.stopPropagation(),e.preventDefault();var t=void 0;try{t=e.originalEvent.dataTransfer.effectAllowed}catch(e){t=null}e.originalEvent.dataTransfer.dropEffect="move"===t||"linkMove"===t?"move":"copy"}),l.on("drop",function(e){e.stopPropagation(),e.preventDefault(),l.trigger("addFileToUploadQueue",[e.originalEvent.dataTransfer.files]),l.removeClass("uploader--file-drop__active")}),l.on("addFileToUploadQueue",{wrapper:o},t),l.on("click",function(e){e.stopPropagation(),e.preventDefault(),s.click()}),s.on("change",function(e){e.stopPropagation(),e.preventDefault(),l.trigger("addFileToUploadQueue",[s[0].files])}),p.on("click",function(e){e.stopPropagation(),e.preventDefault(),o.trigger("uploadFiles",[o.prop("filesToUpload")])}),o.on("filesAdded",{wrapper:o,filesList:d,uploadButton:p},i),o.on("filesUploaded",{wrapper:o,filesList:d,uploadButton:p},n),o.s3(),o.prop("uploaderInitialized",!0)}}e.fn.uploader=function(e){return this.each(function(t,a){r(a,e)})}}(jQuery.noConflict()),void function(e){function t(a){a.stopPropagation(),a.preventDefault();var i=a.data.wrapper,n=e(a.target),r=n.find("> i"),o=r.hasClass("fa-folder-open"),l=n.attr("data-prefix");if(o&&l===i.prop("currentDirectory"))return n.find("> i").removeClass("fa-folder-open").addClass("fa-folder"),void n.find("> ul").slideUp("270");var d={folder:l,files:n.prop("files"),subFolders:n.prop("subFolders")};i.off("click",t),i.trigger("getFiles",[d])}function a(e,a,i){if(!a){var n=e.data.wrapper,r=i.folder,o=i.subFolders,l=n.find('[data-prefix="'+r+'"]');l.prop("files",i.files),l.prop("subFolders",o),n.prop("currentDirectory",r),n.trigger("addFolders",[r,o]),n.on("click","[data-prefix]",{wrapper:n},t)}}function i(e,t){if(e.stopPropagation(),!t){var a=e.data.wrapper,i=a.prop("currentDirectory");a.prop("currentDirectory",""),a.trigger("getFiles",{folder:i})}}function n(t,a,i){var n=e("<li/>",{"data-prefix":a?""+(t||"")+a+"/":"",text:" "+(a===i.prop("rootDirectory")?"My Files":a||"My Files")}),r=e("<i/>",{class:"fa fa-folder","aria-hidden":"true"});return n.prepend(r),n.append(e("<ul/>",{style:"display: none;"})),n}function r(t,a,i){t.stopPropagation();var r=t.data.wrapper,o=r.find('[data-prefix="'+(a||"")+'"]'),l=o.find("> ul");if(o.find("> i").removeClass("fa-folder").addClass("fa-folder-open"),i.forEach(function(e){0===l.find('> [data-prefix="'+(a||"")+e+'/"]').length&&l.append(n(a,e,r))}),0===l.find("> [data-directory]").length){var d=e("<i/>",{class:"fa fa-plus","aria-hidden":"true"}),p=e("<button/>",{text:" New Folder"}),f=e("<li/>",{"data-directory":"new-folder"});p.prepend(d),f.append(p),l.append(f)}l.slideDown("270")}function o(e){e.stopPropagation(),e.preventDefault();var t=e.data.wrapper,a=e.data.input,i=e.data.button,n=e.data.listItem,r=a.val();r?(n.remove(),t.trigger("addFolders",[e.data.prefix,[r]])):(a.remove(),i.removeClass("hidden"))}function l(t){t.stopPropagation(),t.preventDefault();var a=t.data.wrapper,i=e(t.target),n=i.parent();n.append(e("<input/>"));var r=n.find("input"),l=n.closest("[data-prefix]").attr("data-prefix");i.addClass("hidden"),r.focus(),r.on("blur",{wrapper:a,input:r,button:i,listItem:n,prefix:l},o),r.on("keypress",function(e){var t=e.keyCode||e.which;13===t&&r.blur()})}function d(t){var o=e(t);o.prop("directoryInitialized")||(o.on("gotFiles",{wrapper:o},a),o.on("filesDeleted",{wrapper:o},i),o.on("addFolders",{wrapper:o},r),o.on("click",'[data-directory="new-folder"] button',{wrapper:o},l),o.on("s3Initialized",function(){var e=o.prop("rootDirectory");o.find("> ul").append(n(null,e,o)),o.trigger("getFiles",{folder:e+"/"||""})}),o.s3(),o.prop("directoryInitialized",!0))}e.fn.directory=function(){return this.each(function(e,t){d(t)})}}(jQuery.noConflict());
//# sourceMappingURL=fileManager.min.js.map
