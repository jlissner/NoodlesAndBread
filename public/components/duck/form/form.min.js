"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};void function(e,t,a){function c(t){t.stopPropagation(),t.preventDefault(),e(this).closest("[duck-type]").remove(),e(this).closest('[duck-type="array"]').trigger("duckArrayItemDeleted")}function n(t){t.stopPropagation(),t.preventDefault();var a=e(this),r=a.attr("duck-add"),i=a.closest('[duck-type="array"]'),d=i.find("[duck-type]").first(),u=d.parent().find("> [duck-type]").last(),o=d.clone();switch(o.find('[duck-value], [duck-type="wysiwyg"]').val(null),o.find('[duck-button="delete"]').click(c),o.find('[data-function="tabs"]').makeTabs(),"object"===d.attr("duck-type")&&(o.find('input[type="checkbox"], input[type="radio"]').prop("checked",!1),o.find(".summernote").parent().empty().append('<div class="summernote"></div>').find("> .summernote").summernote({height:150}),o.find('[duck-type="array"] > [duck-type]:not(:first-of-type)').remove(),o.find('[duck-button="add"]').click(n)),"image"===d.attr("duck-type")&&(o.attr("duck-image-picker",e("[duck-image-picker]").length),o.prop("filePickerInitiated",!1),o.find("[duck-image-value]").text("")),r){case"after":a.closest("[duck-type]").after(o);break;case"before":a.closest("[duck-type]").before(o);break;default:u.after(o)}d.parent().sortable("[duck-type]"),i.trigger("duckArrayItemAdded"),i.closest('[data-function*="scroll"]').trigger("initScroll")}function r(e,t,a){for(var c="string"==typeof t?t.split("."):t,n=c.length,i=function(t){var i=c[t],d=1===n,u="object"===_typeof(e[i]);if(d&&!u)delete e[i];else if(!u)return"break";var o=e[i]instanceof Array?"array":"object";if("object"===o){var l=c.slice(0);l.splice(0,1),e[i]=r(e[i],l,a)}else{var f=d?e[i].indexOf(a):e[i].map(function(e){return e[c[t+1]]}).indexOf(a);e[i].splice(f,1)}},d=0;d<n;d++){var u=i(d);if("break"===u)break}return e}function i(e,a,c,n){var r=a.attr("duck-key"),i=e[c]||{};r&&!i[r]&&(i[r]=a.attr("duck-key-value")||t.uuid()),e[c]=n(i,t.findRelevantChildren(a,"[duck-field]"))}function d(a,c,n,r){var i=t.findRelevantChildren(c,'[duck-type="object"]'),d=i.first().attr("duck-key")?a[n]||[]:[];i.length?i.each(function(a,c){var n=e(c),i=n.attr("duck-key"),u=n.attr("duck-key-value")||t.uuid(),o=i?d.filter(function(e){return e[i]===u})[0]||{}:{};if(i){o[i]=u;var l=d.map(function(e){return e[i]}).indexOf(o[i]);l!==-1&&d.splice(l,1)}d.push(r(o,t.findRelevantChildren(n,"[duck-field]")))}):c.find("[duck-value]").each(function(t,a){var c=e(a).val();c&&d.push(c)}),(a[n]||d.length)&&(a[n]=d)}function u(t,a,c){var n=[];a.find('input[type="checkbox"]').each(function(t,a){var c=e(a);c.prop("checked")&&n.push(c.val())}),(t[c]||n.length)&&(t[c]=n)}function o(e,t,a){var c=t.find('input[type="radio"]:checked').val();(e[a]||c)&&(e[a]=c)}function l(e,t,a,c){var n=c||".summernote",r=t.find(n).summernote("code");r&&(e[a]=r)}function f(t,a){return a.each(function(a,c){var n=e(c),r=n.attr("duck-field"),k=n.attr("duck-type");switch(k){case"object":i(t,n,r,f);break;case"array":d(t,n,r,f);break;case"checkbox":u(t,n,r);break;case"radio":o(t,n,r);break;case"bool":t[r]=n.prop("checked")||n.find('input[type="checkbox"]').prop("checked");break;case"wysiwyg":l(t,n,r);break;case"image":case"select":case"number":case"string":default:var p=n.val(),s=p?p:n.find("[duck-value]").val();(t[r]||s)&&(t[r]=s)}}),t}function k(e,t){t.on("input",function(){e.val(t.val().replace(/'/g,"").replace(/[^a-zA-Z0-9]/g,"-").toLowerCase()).trigger("validate")})}function p(e,a,c,n,r,i){var d={};d[a]=c||t.uuid(),t(e).add(f(d,n),r,i)}function s(e,a,c,n,r,i){t(e).get({field:a,value:c,findOne:!0},function(a){var c=f(a,n);t(e).update(c,r,i)})}function y(e,c,n,r){t(e).delete(n,function(){var e=a.location.href.split("/"),t=r.attr("duck-goTo");e[e.length-1]?e.pop():(e.pop(),e.pop());var c=t?t:e.join("/");a.location.href===c?a.location.reload(!0):a.location.href=c})}function v(e,a,c,n,i,d){var u=n.attr("duck-delete-path"),o=n.attr("duck-delete-value");t(e).get({field:a,value:c,findOne:!0},function(a){var c=r(a,u,o);t(e).update(c,i,d)})}function b(t){var a=t.data.wrapper;a.attr("duck-edit-form","view"===a.attr("duck-edit-form")?"edit":"view"),e('[data-function*="scroll"]').trigger("initScroll")}function h(t){t.preventDefault(),t.stopPropagation();var a=t.data.crud,c=t.data.table,n=t.data.key,r=t.data.keyValue,i=t.data.startOfFields,d=t.data.wrapper,u=t.data.successCallback,o=t.data.failureCallBack;switch(e(t.currentTarget).prop("disabled",!0),a){case"add":p(c,n,r,i,u,o);break;case"update":s(c,n,r,i,u,o);break;case"delete":y(c,n,r,d);break;case"deleteField":v(c,n,r,d,u,o)}}function m(r,i){var d=e(r),u=t.findRelevantChildren(d,"[duck-field]"),o=d.find('[duck-button="edit"]'),l=d.find('[duck-button="cancel"]'),f=i&&i.table||d.attr("duck-table"),p=i&&i.crud||d.attr("duck-function"),s=i&&i.key||d.attr("duck-key"),y=i&&i.keyValue||d.attr("duck-key-value"),v=d.find('[duck-field="url"] input'),m=i&&i.successCallback||function(){a.location.reload(!0)},g=i&&i.failureCallBack||function(){a.location.reload(!0)};v.length&&k(v,d.find('[duck-field="names"] [duck-field="display"] input')),f&&p&&s&&("update"!==p&&"delete"!==p||y)&&(o.off("click",b).on("click",{wrapper:d},b),l.off("click",b).on("click",{wrapper:d},b),d.off("click",h).on("click",'[duck-button="submit"]',{crud:p,table:f,key:s,keyValue:y,wrapper:d,startOfFields:u,successCallback:m,failureCallBack:g},h),d.find('[duck-type="array"]').each(function(a,c){var n=e(c),r=t.findRelevantChildren(n,"[duck-type]");r.first().parent().sortable("[duck-type]")}),d.find('[duck-button="add"]').off("click",n).click(n),d.find('[duck-button="delete"]').off("click",c).click(c))}e.fn.duckForm=function(e){return this.each(function(t,a){m(a,e)})},e(function(){e("[duck-table]").duckForm()})}(jQuery.noConflict(),duck,window);
//# sourceMappingURL=form.min.js.map
