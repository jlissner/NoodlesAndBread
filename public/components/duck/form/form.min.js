"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};void function(e,t,a,r){function n(t){t.stopPropagation(),t.preventDefault(),e(this).closest("[duck-type]").remove(),e(this).closest('[duck-type="array"]').trigger("duckArrayItemDeleted")}function c(t){t.stopPropagation(),t.preventDefault();var r=e(this),i=r.attr("duck-add"),o=r.closest('[duck-type="array"]'),d=o.find("[duck-type]").first(),u=d.parent().find("> [duck-type]").last(),l=d.clone();switch(i){case"after":r.closest("[duck-type]").after(l);break;case"before":r.closest("[duck-type]").before(l);break;default:u.after(l)}l.find('[duck-value], [duck-type="wysiwyg"]').val(null),l.find('input[type="checkbox"], input[type="radio"]').prop("checked",!1),l.find('[data-sort="item"]:not(:first-of-type)').remove(),l.find('[duck-button="delete"]').click(n),l.find('[duck-button="add"]').click(c),l.find('[data-function="tabs"]').makeTabs(),l.find('[data-function*="accordion"]').makeAccordion(),l.find('[duck-type="code"]').each(function(t,r){var n=e(r).find('[data-function*="codemirror"]');n.html("");var c=n[0],i=n.parent().find('[data-codemirror="preview"]');i.html("");var o=a(c,{smartIndent:!0,indentWithTabs:!0,lineNumbers:!0,mode:n.attr("data-mode")||"pug"});if(!n.is(":visible"))var d=setInterval(function(){n.is(":visible")&&(o.refresh(),clearTimeout(d))},250);if(n.prop("codemirror",function(){return o}),i.length){var u=void 0;n.on("input",function(t){t.stopPropagation(),t.preventDefault(),clearTimeout(u),u=setTimeout(function(){e.ajax({url:"/renderPug",data:{pug:n.prop("codemirror").getValue(),locals:{}},success:function(e){i.html(e)}})},1e3)})}}),l.find("[duck-image-value]").text("This isn't working yet."),l.find('input[type="color"]').spectrum({showInput:!0,preferredFormat:"hex"}),l.find(".bs-date").datetimepicker({format:"MM/DD/YYYY"}),l.find(".summernote").summernote("destroy").summernote({height:"150px"}),d.parent().sortable("[duck-type]"),o.trigger("duckArrayItemAdded"),o.closest('[data-function*="scroll"]').trigger("initScroll")}function i(e,t,a){for(var r="string"==typeof t?t.split("."):t,n=r.length,c=function(t){var c=r[t],o=1===n,d="object"===_typeof(e[c]);if(o&&!d)delete e[c];else if(!d)return"break";var u=e[c]instanceof Array?"array":"object";if("object"===u){var l=r.slice(0);l.splice(0,1),e[c]=i(e[c],l,a)}else{var f=o?e[c].indexOf(a):e[c].map(function(e){return e[r[t+1]]}).indexOf(a);e[c].splice(f,1)}},o=0;o<n;o++){var d=c(o);if("break"===d)break}return e}function o(e,a,r,n){var c=a.attr("duck-key"),i=e[r]||{};c&&!i[c]&&(i[c]=a.attr("duck-key-value")||t.uuid()),e[r]=n(i,t.findRelevantChildren(a,"[duck-field]"))}function d(a,r,n,c){var i=t.findRelevantChildren(r,'[duck-type="object"]'),o=i.first().attr("duck-key")?a[n]||[]:[];i.length?i.each(function(a,r){var n=e(r),i=n.attr("duck-key"),d=n.attr("duck-key-value")||t.uuid(),u=i?o.filter(function(e){return e[i]===d})[0]||{}:{};if(i){u[i]=d;var l=o.map(function(e){return e[i]}).indexOf(u[i]);l!==-1&&o.splice(l,1)}var f=c(u,t.findRelevantChildren(n,"[duck-field]"));o.push(f)}):r.find("[duck-value]").each(function(t,a){var r=e(a).val();r&&o.push(r)}),(a[n]||o.length)&&(a[n]=o)}function u(t,a,r){var n=[];a.find('input[type="checkbox"]').each(function(t,a){var r=e(a);r.prop("checked")&&n.push(r.val())}),(t[r]||n.length)&&(t[r]=n)}function l(e,t,a){var r=t.find('input[type="radio"]:checked').val();(e[a]||r)&&(e[a]=r)}function f(e,t,a){var r=t.find(".summernote").summernote("code");r&&(e[a]=r)}function s(e,t,a){var r=t.find('[data-function*="codemirror"]').prop("codemirror"),n=r.getValue();n&&(e[a]=n)}function k(t,a){var r=t instanceof Array?t[0]:t;return a.each(function(t,a){var n=e(a),c=n.attr("duck-field"),i=n.attr("duck-type");switch(i){case"object":o(r,n,c,k);break;case"array":d(r,n,c,k),console.log(2,c,r,r[c]);break;case"checkbox":u(r,n,c);break;case"radio":l(r,n,c);break;case"bool":r[c]=n.prop("checked")||n.find('input[type="checkbox"]').prop("checked");break;case"wysiwyg":f(r,n,c);break;case"code":s(r,n,c);break;case"image":case"select":case"number":case"string":default:var p=n.val(),v=p?p:n.find("[duck-value]").val();(r[c]||v)&&(r[c]=v)}}),console.log(3,r),r}function p(e,a,r,n,c,i,o,d){var u={};u[a]=r||t.uuid(),n&&(u[n]=c||t.uuid()),t(e).add(k(u,i),o,d)}function v(e,a,r,n,c,i,o,d){t(e).get({key:a,value:r},{key:n,value:c},{findOne:!0},function(a){var r=k(a,i);t(e).update(r,o,d)})}function y(e,a,n,c,i,o){t(e).delete(n,function(){var e=r.location.href.split("/"),t=o.attr("duck-goTo");e[e.length-1]?e.pop():(e.pop(),e.pop());var a=t?t:e.join("/");r.location.href===a?r.location.reload(!0):r.location.href=a})}function b(e,a,r,n,c,o){var d=n.attr("duck-delete-path"),u=n.attr("duck-delete-value");t(e).get({field:a,value:r,findOne:!0},function(a){var r=i(a,d,u);t(e).update(r,c,o)})}function m(t){var a=t.data.wrapper;a.attr("duck-edit-form","view"===a.attr("duck-edit-form")?"edit":"view"),e('[data-function*="scroll"]').trigger("initScroll")}function h(t){t.preventDefault(),t.stopPropagation();var a=t.data.crud,r=t.data.table,n=t.data.key,c=t.data.keyValue,i=t.data.range,o=t.data.rangeValue,d=t.data.startOfFields,u=t.data.wrapper,l=t.data.successCallback,f=t.data.failureCallBack;switch(e(t.currentTarget).prop("disabled",!0),a){case"add":p(r,n,c,i,o,d,l,f);break;case"update":v(r,n,c,i,o,d,l,f);break;case"delete":y(r,n,c,i,o,u);break;case"deleteField":b(r,n,c,i,o,u,l,f)}}function g(a,i){var o=e(a),d=t.findRelevantChildren(o,"[duck-field]"),u=o.find('[duck-button="edit"]'),l=i&&i.table||o.attr("duck-table"),f=i&&i.crud||o.attr("duck-function"),s=i&&i.key||o.attr("duck-key")||"Id",k=i&&i.keyValue||o.attr("duck-key-value"),p=i&&i.range||o.attr("duck-range")||"_Id",v=p&&(i&&i.rangeValue||o.attr("duck-range-value")),y=i&&i.successCallback||function(){r.location.reload(!0)},b=i&&i.failureCallBack||function(){r.location.reload(!0)};if(!(l&&f&&s&&("update"!==f&&"delete"!==f||k)))throw new Error("Missing Required information.");u.off("click",m).on("click",{wrapper:o},m),o.off("click",h).on("click",'[duck-button="submit"]',{crud:f,table:l,key:s,keyValue:k,range:p,rangeValue:v,wrapper:o,startOfFields:d,successCallback:y,failureCallBack:b},h),o.find('[duck-type="array"]').each(function(a,r){var n=e(r),c=t.findRelevantChildren(n,"[duck-type]");c.first().parent().sortable("[duck-type]")}),o.find('[duck-button="add"]').off("click",c).click(c),o.find('[duck-button="delete"]').off("click",n).click(n)}e.fn.duckForm=function(e){return this.each(function(t,a){g(a,e)})},e(function(){e("[duck-table]").duckForm()})}(jQuery.noConflict(),duck,CodeMirror,window);
//# sourceMappingURL=form.min.js.map
