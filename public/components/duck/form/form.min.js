"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};void function(e,t,a,r,n){function i(t){t.stopPropagation(),t.preventDefault(),e(this).closest("[duck-type]").remove(),e(this).closest('[duck-type="array"]').trigger("duckArrayItemDeleted")}function c(t){t.stopPropagation(),t.preventDefault();var n=e(this),o=n.attr("duck-add"),u=n.closest('[duck-type="array"]'),d=u.find("[duck-type]").first(),l=d.parent().find("> [duck-type]").last(),f=d.clone();switch(o){case"after":n.closest("[duck-type]").after(f);break;case"before":n.closest("[duck-type]").before(f);break;default:l.after(f)}if(f.find('[duck-value], [duck-type="wysiwyg"]').val(null),f.find('[duck-button="delete"]').click(i),f.find('[data-function="tabs"]').makeTabs(),"object"===d.attr("duck-type")&&(f.find('input[type="checkbox"], input[type="radio"]').prop("checked",!1),f.find('[duck-type="array"] > [duck-type]:not(:first-of-type)').remove(),f.find('[duck-button="add"]').click(c),f.find('[duck-type="code"]').each(function(){var t=f.find('[data-function*="codemirror"]');t.html("");var a=t[0],n=t.parent().find('[data-codemirror="preview"]');n.html("");var i=r(a,{smartIndent:!0,indentWithTabs:!0,lineNumbers:!0,mode:t.attr("data-mode")||"pug"});if(!t.is(":visible"))var c=setInterval(function(){t.is(":visible")&&(i.refresh(),clearTimeout(c))},250);if(t.prop("codemirror",function(){return i}),n.length){var o=void 0;t.on("input",function(a){a.stopPropagation(),a.preventDefault(),clearTimeout(o),o=setTimeout(function(){e.ajax({url:"/renderPug",data:{pug:t.prop("codemirror").getValue(),locals:{}},success:function(e){n.html(e)}})},1e3)})}})),"image"===d.attr("duck-type")&&f.find("[duck-image-value]").text("This isn't working yet."),"color"===d.attr("duck-type")&&f.spectrum({showInput:!0,preferredFormat:"hex"}),"date"===d.attr("duck-type")&&f.datetimepicker({format:"MM/DD/YYYY"}),"wysiwyg"===d.attr("duck-type")){var p=new a({element:f.find(".simpleMDE").html("<textarea>").find("textarea")[0],autoDownloadFontAwesome:!1});f.find(".simpleMDE").prop("simpleMDE",function(){return p})}if("code"===d.attr("duck-type")){var s=f.find('[data-function*="codemirror"]'),k=s[0],v=s.attr("data-preview-target"),y=r(k,{smartIndent:!0,indentWithTabs:!0,lineNumbers:!0,mode:s.attr("data-mode")||"pug"});if(!s.is(":visible"))var b=setInterval(function(){s.is(":visible")&&(y.refresh(),clearTimeout(b))},250);if(s.prop("codemirror",function(){return y}),v){var m=e(v),g=void 0;s.on("input",function(t){t.stopPropagation(),t.preventDefault(),clearTimeout(g),g=setTimeout(function(){e.ajax({url:"/renderPug",data:{pug:s.prop("codemirror").getValue(),locals:{}},success:function(e){m.html(e)}})},1e3)})}}d.parent().sortable("[duck-type]"),u.trigger("duckArrayItemAdded"),u.closest('[data-function*="scroll"]').trigger("initScroll")}function o(e,t,a){for(var r="string"==typeof t?t.split("."):t,n=r.length,i=function(t){var i=r[t],c=1===n,u="object"===_typeof(e[i]);if(c&&!u)delete e[i];else if(!u)return"break";var d=e[i]instanceof Array?"array":"object";if("object"===d){var l=r.slice(0);l.splice(0,1),e[i]=o(e[i],l,a)}else{var f=c?e[i].indexOf(a):e[i].map(function(e){return e[r[t+1]]}).indexOf(a);e[i].splice(f,1)}},c=0;c<n;c++){var u=i(c);if("break"===u)break}return e}function u(e,a,r,n){var i=a.attr("duck-key"),c=e[r]||{};i&&!c[i]&&(c[i]=a.attr("duck-key-value")||t.uuid()),e[r]=n(c,t.findRelevantChildren(a,"[duck-field]"))}function d(a,r,n,i){var c=t.findRelevantChildren(r,'[duck-type="object"]'),o=c.first().attr("duck-key")?a[n]||[]:[];c.length?c.each(function(a,r){var n=e(r),c=n.attr("duck-key"),u=n.attr("duck-key-value")||t.uuid(),d=c?o.filter(function(e){return e[c]===u})[0]||{}:{};if(c){d[c]=u;var l=o.map(function(e){return e[c]}).indexOf(d[c]);l!==-1&&o.splice(l,1)}o.push(i(d,t.findRelevantChildren(n,"[duck-field]")))}):r.find("[duck-value]").each(function(t,a){var r=e(a).val();r&&o.push(r)}),(a[n]||o.length)&&(a[n]=o)}function l(t,a,r){var n=[];a.find('input[type="checkbox"]').each(function(t,a){var r=e(a);r.prop("checked")&&n.push(r.val())}),(t[r]||n.length)&&(t[r]=n)}function f(e,t,a){var r=t.find('input[type="radio"]:checked').val();(e[a]||r)&&(e[a]=r)}function p(e,t,a){var r=".simpleMDE > textarea",n=t.find(r).prop("simpleMDE").value();n&&(e[a]=n)}function s(e,t,a){var r=t.find('[data-function*="codemirror"]').prop("codemirror"),n=r.getValue();n&&(e[a]=n)}function k(t,a){return a.each(function(a,r){var n=e(r),i=n.attr("duck-field"),c=n.attr("duck-type");switch(c){case"object":u(t,n,i,k);break;case"array":d(t,n,i,k);break;case"checkbox":l(t,n,i);break;case"radio":f(t,n,i);break;case"bool":t[i]=n.prop("checked")||n.find('input[type="checkbox"]').prop("checked");break;case"wysiwyg":p(t,n,i);break;case"code":s(t,n,i);break;case"image":case"select":case"number":case"string":default:var o=n.val(),v=o?o:n.find("[duck-value]").val();(t[i]||v)&&(t[i]=v)}}),t}function v(e,t){t.on("input",function(){e.val(t.val().replace(/'/g,"").replace(/[^a-zA-Z0-9]/g,"-").toLowerCase()).trigger("validate")})}function y(e,a,r,n,i,c,o,u){var d={};d[a]=r||t.uuid(),n&&(d[n]=i||t.uuid()),t(e).add(k(d,c),o,u)}function b(e,a,r,n,i,c,o,u){t(e).get({field:a,value:r,findOne:!0},function(a){var r=k(a,c);t(e).update(r,o,u)})}function m(e,a,r,i){t(e).delete(r,function(){var e=n.location.href.split("/"),t=i.attr("duck-goTo");e[e.length-1]?e.pop():(e.pop(),e.pop());var a=t?t:e.join("/");n.location.href===a?n.location.reload(!0):n.location.href=a})}function g(e,a,r,n,i,c){var u=n.attr("duck-delete-path"),d=n.attr("duck-delete-value");t(e).get({field:a,value:r,findOne:!0},function(a){var r=o(a,u,d);t(e).update(r,i,c)})}function h(t){var a=t.data.wrapper;a.attr("duck-edit-form","view"===a.attr("duck-edit-form")?"edit":"view"),e('[data-function*="scroll"]').trigger("initScroll")}function w(t){t.preventDefault(),t.stopPropagation();var a=t.data.crud,r=t.data.table,n=t.data.key,i=t.data.keyValue,c=t.data.range,o=t.data.rangeValue,u=t.data.startOfFields,d=t.data.wrapper,l=t.data.successCallback,f=t.data.failureCallBack;switch(e(t.currentTarget).prop("disabled",!0),a){case"add":y(r,n,i,c,o,u,l,f);break;case"update":b(r,n,i,c,o,u,l,f);break;case"delete":m(r,n,i,c,o,d);break;case"deleteField":g(r,n,i,c,o,d,l,f)}}function D(a,r){var o=e(a),u=t.findRelevantChildren(o,"[duck-field]"),d=o.find('[duck-button="edit"]'),l=o.find('[duck-button="cancel"]'),f=r&&r.table||o.attr("duck-table"),p=r&&r.crud||o.attr("duck-function"),s=r&&r.key||o.attr("duck-key"),k=r&&r.keyValue||o.attr("duck-key-value"),y=r&&r.range||o.attr("duck-range"),b=y&&(r&&r.rangeValue||o.attr("duck-range-value")),m=o.find('[duck-field="url"] input'),g=r&&r.successCallback||function(){n.location.reload(!0)},D=r&&r.failureCallBack||function(){n.location.reload(!0)};m.length&&v(m,o.find('[duck-field="names"] [duck-field="display"] input')),f&&p&&s&&("update"!==p&&"delete"!==p||k)&&(d.off("click",h).on("click",{wrapper:o},h),l.off("click",h).on("click",{wrapper:o},h),o.off("click",w).on("click",'[duck-button="submit"]',{crud:p,table:f,key:s,keyValue:k,range:y,rangeValue:b,wrapper:o,startOfFields:u,successCallback:g,failureCallBack:D},w),o.find('[duck-type="array"]').each(function(a,r){var n=e(r),i=t.findRelevantChildren(n,"[duck-type]");i.first().parent().sortable("[duck-type]")}),o.find('[duck-button="add"]').off("click",c).click(c),o.find('[duck-button="delete"]').off("click",i).click(i))}e.fn.duckForm=function(e){return this.each(function(t,a){D(a,e)})},e(function(){e("[duck-table]").duckForm()})}(jQuery.noConflict(),duck,SimpleMDE,CodeMirror,window);
//# sourceMappingURL=form.min.js.map
